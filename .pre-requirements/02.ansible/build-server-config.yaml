---
  - hosts: buildnodes
    gather_facts: no
    become: yes
    tasks:
      - name: Install the required packages
        apt:
          name: "{{ item }}"
          state: present
        with_items:
          - openjdk-17-jre
          - git

      - name: Installation of Docker
        shell: 
          cmd: |
            sudo apt-get update
            sudo apt-get install ca-certificates curl
            sudo install -m 0755 -d /etc/apt/keyrings
            sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
            sudo chmod a+r /etc/apt/keyrings/docker.asc
            echo \
              "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
              $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" | \
              sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
            sudo apt-get update
            sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
      - name: Adding user to docker group
        shell: usermod -aG docker skmirza
      - name: Verify Installations
        shell: java --version && git --version && docker --version
        register: builds_version
      - name: Print Java, Git and Docker Version
        debug:
          msg: "Java, Git and Docker Version is: {{ builds_version.stdout }}"
      
      - name: Install the required packages
        apt:
          name: "{{ item }}"
          state: present
        with_items:
          - maven
          - gradle
      - name: Verifying Maven and Gradle installation
        shell: mvn --version && gradle --version
        register: mvn_gradle_version
      - name: Print Maven and Gradle Version
        debug:
          msg: "Maven and Gradle Version is: {{ mvn_gradle_version.stdout }}"
        when: inventory_hostname == "MvnB"
      
